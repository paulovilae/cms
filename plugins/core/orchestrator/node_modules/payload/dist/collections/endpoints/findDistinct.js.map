{"version":3,"sources":["../../../src/collections/endpoints/findDistinct.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\nimport type { Where } from '../../types/index.js'\n\nimport { APIError } from '../../errors/APIError.js'\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { isNumber } from '../../utilities/isNumber.js'\nimport { findDistinctOperation } from '../operations/findDistinct.js'\n\nexport const findDistinctHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n  const { depth, field, limit, page, sort, where } = req.query as {\n    depth?: string\n    field?: string\n    limit?: string\n    page?: string\n    sort?: string\n    sortOrder?: string\n    where?: Where\n  }\n\n  if (!field) {\n    throw new APIError('field must be specified', httpStatus.BAD_REQUEST)\n  }\n\n  const result = await findDistinctOperation({\n    collection,\n    depth: isNumber(depth) ? Number(depth) : undefined,\n    field,\n    limit: isNumber(limit) ? Number(limit) : undefined,\n    page: isNumber(page) ? Number(page) : undefined,\n    req,\n    sort: typeof sort === 'string' ? sort.split(',') : undefined,\n    where,\n  })\n\n  return Response.json(result, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","APIError","getRequestCollection","headersWithCors","isNumber","findDistinctOperation","findDistinctHandler","req","collection","depth","field","limit","page","sort","where","query","BAD_REQUEST","result","Number","undefined","split","Response","json","headers","Headers","OK"],"mappings":"AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAKlD,SAASC,QAAQ,QAAQ,2BAA0B;AACnD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,QAAQ,QAAQ,8BAA6B;AACtD,SAASC,qBAAqB,QAAQ,gCAA+B;AAErE,OAAO,MAAMC,sBAAsC,OAAOC;IACxD,MAAMC,aAAaN,qBAAqBK;IACxC,MAAM,EAAEE,KAAK,EAAEC,KAAK,EAAEC,KAAK,EAAEC,IAAI,EAAEC,IAAI,EAAEC,KAAK,EAAE,GAAGP,IAAIQ,KAAK;IAU5D,IAAI,CAACL,OAAO;QACV,MAAM,IAAIT,SAAS,2BAA2BD,WAAWgB,WAAW;IACtE;IAEA,MAAMC,SAAS,MAAMZ,sBAAsB;QACzCG;QACAC,OAAOL,SAASK,SAASS,OAAOT,SAASU;QACzCT;QACAC,OAAOP,SAASO,SAASO,OAAOP,SAASQ;QACzCP,MAAMR,SAASQ,QAAQM,OAAON,QAAQO;QACtCZ;QACAM,MAAM,OAAOA,SAAS,WAAWA,KAAKO,KAAK,CAAC,OAAOD;QACnDL;IACF;IAEA,OAAOO,SAASC,IAAI,CAACL,QAAQ;QAC3BM,SAASpB,gBAAgB;YACvBoB,SAAS,IAAIC;YACbjB;QACF;QACAR,QAAQC,WAAWyB,EAAE;IACvB;AACF,EAAC"}