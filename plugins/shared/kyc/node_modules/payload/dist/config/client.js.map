{"version":3,"sources":["../../src/config/client.ts"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type { DeepPartial } from 'ts-essentials'\n\nimport type { ImportMap } from '../bin/generateImportMap/index.js'\nimport type { ClientBlock } from '../fields/config/types.js'\nimport type { BlockSlug } from '../index.js'\nimport type {\n  RootLivePreviewConfig,\n  SanitizedConfig,\n  ServerOnlyLivePreviewProperties,\n} from './types.js'\n\nimport {\n  type ClientCollectionConfig,\n  createClientCollectionConfigs,\n} from '../collections/config/client.js'\nimport { createClientBlocks } from '../fields/config/client.js'\nimport { type ClientGlobalConfig, createClientGlobalConfigs } from '../globals/config/client.js'\n\nexport type ServerOnlyRootProperties = keyof Pick<\n  SanitizedConfig,\n  | 'bin'\n  | 'cors'\n  | 'csrf'\n  | 'custom'\n  | 'db'\n  | 'editor'\n  | 'email'\n  | 'endpoints'\n  | 'graphQL'\n  | 'hooks'\n  | 'i18n'\n  | 'jobs'\n  | 'logger'\n  | 'onInit'\n  | 'plugins'\n  | 'queryPresets'\n  | 'secret'\n  | 'sharp'\n  | 'typescript'\n>\n\nexport type ServerOnlyRootAdminProperties = keyof Pick<SanitizedConfig['admin'], 'components'>\n\nexport type UnsanitizedClientConfig = {\n  admin: {\n    livePreview?: Omit<RootLivePreviewConfig, ServerOnlyLivePreviewProperties>\n  } & Omit<SanitizedConfig['admin'], 'components' | 'dependencies' | 'livePreview'>\n  blocks: ClientBlock[]\n  collections: ClientCollectionConfig[]\n  custom?: Record<string, any>\n  globals: ClientGlobalConfig[]\n} & Omit<SanitizedConfig, 'admin' | 'collections' | 'globals' | 'i18n' | ServerOnlyRootProperties>\n\nexport type ClientConfig = {\n  admin: {\n    livePreview?: Omit<RootLivePreviewConfig, ServerOnlyLivePreviewProperties>\n  } & Omit<SanitizedConfig['admin'], 'components' | 'dependencies' | 'livePreview'>\n  blocks: ClientBlock[]\n  blocksMap: Record<BlockSlug, ClientBlock>\n  collections: ClientCollectionConfig[]\n  custom?: Record<string, any>\n  globals: ClientGlobalConfig[]\n} & Omit<SanitizedConfig, 'admin' | 'collections' | 'globals' | 'i18n' | ServerOnlyRootProperties>\n\nexport const serverOnlyAdminConfigProperties: readonly Partial<ServerOnlyRootAdminProperties>[] = []\n\nexport const serverOnlyConfigProperties: readonly Partial<ServerOnlyRootProperties>[] = [\n  'endpoints',\n  'db',\n  'editor',\n  'plugins',\n  'sharp',\n  'onInit',\n  'secret',\n  'hooks',\n  'bin',\n  'i18n',\n  'typescript',\n  'cors',\n  'csrf',\n  'email',\n  'custom',\n  'graphQL',\n  'jobs',\n  'logger',\n  'queryPresets',\n  // `admin`, `onInit`, `localization`, `collections`, and `globals` are all handled separately\n]\n\nexport const createClientConfig = ({\n  config,\n  i18n,\n  importMap,\n}: {\n  config: SanitizedConfig\n  i18n: I18nClient\n  importMap: ImportMap\n}): ClientConfig => {\n  const clientConfig = {} as DeepPartial<ClientConfig>\n\n  for (const key in config) {\n    if (serverOnlyConfigProperties.includes(key as any)) {\n      continue\n    }\n\n    switch (key) {\n      case 'admin':\n        clientConfig.admin = {\n          autoLogin: config.admin.autoLogin,\n          avatar: config.admin.avatar,\n          custom: config.admin.custom,\n          dateFormat: config.admin.dateFormat,\n          importMap: config.admin.importMap,\n          meta: config.admin.meta,\n          routes: config.admin.routes,\n          theme: config.admin.theme,\n          timezones: config.admin.timezones,\n          user: config.admin.user,\n        }\n\n        if (config.admin.livePreview) {\n          clientConfig.admin.livePreview = {}\n\n          if (config.admin.livePreview.breakpoints) {\n            clientConfig.admin.livePreview.breakpoints = config.admin.livePreview.breakpoints\n          }\n\n          if (config.admin.livePreview.collections) {\n            clientConfig.admin.livePreview.collections = config.admin.livePreview.collections\n          }\n\n          if (config.admin.livePreview.globals) {\n            clientConfig.admin.livePreview.globals = config.admin.livePreview.globals\n          }\n        }\n\n        break\n\n      case 'blocks': {\n        ;(clientConfig.blocks as ClientBlock[]) = createClientBlocks({\n          blocks: config.blocks!,\n          defaultIDType: config.db.defaultIDType,\n          i18n,\n          importMap,\n        }).filter((block) => typeof block !== 'string') as ClientBlock[]\n\n        break\n      }\n\n      case 'collections':\n        ;(clientConfig.collections as ClientCollectionConfig[]) = createClientCollectionConfigs({\n          collections: config.collections,\n          defaultIDType: config.db.defaultIDType,\n          i18n,\n          importMap,\n        })\n\n        break\n\n      case 'folders':\n        if (config.folders) {\n          clientConfig.folders = {\n            slug: config.folders.slug,\n            browseByFolder: config.folders.browseByFolder,\n            debug: config.folders.debug,\n            fieldName: config.folders.fieldName,\n          }\n        }\n\n        break\n\n      case 'globals':\n        ;(clientConfig.globals as ClientGlobalConfig[]) = createClientGlobalConfigs({\n          defaultIDType: config.db.defaultIDType,\n          globals: config.globals,\n          i18n,\n          importMap,\n        })\n\n        break\n\n      case 'localization':\n        if (typeof config.localization === 'object' && config.localization) {\n          clientConfig.localization = {}\n\n          if (config.localization.defaultLocale) {\n            clientConfig.localization.defaultLocale = config.localization.defaultLocale\n          }\n\n          if (config.localization.defaultLocalePublishOption) {\n            clientConfig.localization.defaultLocalePublishOption =\n              config.localization.defaultLocalePublishOption\n          }\n\n          if (config.localization.fallback) {\n            clientConfig.localization.fallback = config.localization.fallback\n          }\n\n          if (config.localization.localeCodes) {\n            clientConfig.localization.localeCodes = config.localization.localeCodes\n          }\n\n          if (config.localization.locales) {\n            clientConfig.localization.locales = []\n\n            for (const locale of config.localization.locales) {\n              if (locale) {\n                const clientLocale: Partial<(typeof config.localization.locales)[0]> = {}\n\n                if (locale.code) {\n                  clientLocale.code = locale.code\n                }\n\n                if (locale.fallbackLocale) {\n                  clientLocale.fallbackLocale = locale.fallbackLocale\n                }\n\n                if (locale.label) {\n                  clientLocale.label = locale.label\n                }\n\n                if (locale.rtl) {\n                  clientLocale.rtl = locale.rtl\n                }\n\n                clientConfig.localization.locales.push(clientLocale)\n              }\n            }\n          }\n        }\n\n        break\n\n      default:\n        ;(clientConfig as any)[key] = config[key as keyof SanitizedConfig]\n    }\n  }\n\n  return clientConfig as ClientConfig\n}\n"],"names":["createClientCollectionConfigs","createClientBlocks","createClientGlobalConfigs","serverOnlyAdminConfigProperties","serverOnlyConfigProperties","createClientConfig","config","i18n","importMap","clientConfig","key","includes","admin","autoLogin","avatar","custom","dateFormat","meta","routes","theme","timezones","user","livePreview","breakpoints","collections","globals","blocks","defaultIDType","db","filter","block","folders","slug","browseByFolder","debug","fieldName","localization","defaultLocale","defaultLocalePublishOption","fallback","localeCodes","locales","locale","clientLocale","code","fallbackLocale","label","rtl","push"],"mappings":"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"}